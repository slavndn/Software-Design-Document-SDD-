**1. Введение**

*   **Цель документа:** Предоставить подробное описание архитектуры и проектных решений для реализации 2D игры "Танки" с использованием Python и Pygame.
*   **Область применения:** Данный документ предназначен для разработчиков, участвующих в создании игры, а также для всех заинтересованных в понимании ее архитектуры.
*   **Ссылки:**
    *   [SRS документация для игры "Танки"] (Ссылка на ваш документ SRS из предыдущей части лабораторной работы)

**2. Общее описание системы**

*   **Обзор системы:** "Танки" - это аркадная игра, в которой два игрока управляют танками на арене, сражаясь друг с другом, избегая препятствий и собирая бонусы. Игра включает в себя главное меню, экран игры, экран настроек, экран инструкций и экран "Game Over".
*   **Архитектурные ограничения:**
    *   Игра должна быть разработана на Python 3.8 с использованием библиотеки Pygame 2.0.
    *   Игра должна использовать объектно-ориентированный подход.
    *   Игра должна поддерживать разрешение 800x600 пикселей.

**3. Архитектурный дизайн**

*   **Архитектурный подход:** Игра использует объектно-ориентированную архитектуру, где основные игровые элементы (танки, пули, блоки, бонусы, взрывы) представлены в виде отдельных классов. Управление игрой и отрисовка осуществляются в основном цикле игры.
*   **Диаграмма архитектуры:**

    ```mermaid
    graph LR
        Game(Game) -->|управляет| Tank1(Tank);
        Game -->|управляет| Tank2(Tank);
        Game -->|управляет| Bullet(Bullet);
        Game -->|управляет| Block(Block);
        Game -->|управляет| Bang(Bang);
        Game -->|управляет| Bonus(Bonus);
        Game -->|отрисовывает| Window(Window);
        Tank1 -->|стреляет| Bullet;
        Tank2 -->|стреляет| Bullet;
    ```

    *   **Game:** Основной класс, управляющий игровым циклом, обработкой событий, обновлением состояний и отрисовкой экрана.
    *   **Tank:** Класс, представляющий танк игрока, отвечает за его перемещение, стрельбу и управление параметрами (ранг, здоровье).
    *   **Bullet:** Класс, представляющий снаряд, выпущенный танком.
    *   **Block:** Класс, представляющий блоки-препятствия.
    *   **Bang:** Класс, представляющий анимацию взрыва.
    *   **Bonus:** Класс, представляющий бонусы на карте.
    *   **Window:** Объект pygame.display, предоставляющий окно для отрисовки.

**4. Детальное описание компонентов**

*   **4.1. Класс `Game`**
    *   **Описание:** Управляет основным игровым циклом, обрабатывает события, обновляет состояние игры, отрисовывает объекты и управляет переходами между экранами.
    *   **Методы:**
        *   `run()`: Запускает основной игровой цикл.
        *   `handle_events()`: Обрабатывает события ввода (нажатия клавиш, клики мыши).
        *   `update()`: Обновляет состояние игры (позиции объектов, столкновения, бонусы).
        *   `draw()`: Отрисовывает текущий кадр игры.
        *    `start_game()`: Инициализирует игровые объекты и запускает игровой процесс.
        *   `show_settings()`: Отображает меню настроек и позволяет регулировать громкость.
        *   `show_instructions()`: Отображает экран инструкций.
        *   `check_win()`: Проверяет условие победы.

*   **4.2. Класс `Tank`**
    *   **Описание:** Представляет танк игрока, обрабатывает его перемещение, стрельбу и урон, а также сохраняет текущий ранг и здоровье.
    *   **Атрибуты:**
        *   `color`: Цвет танка (строка).
        *   `rect`: Прямоугольник для определения позиции и столкновений (pygame.Rect).
        *   `direct`: Направление движения танка (целое число: 0-вверх, 1-вправо, 2-вниз, 3-влево).
        *   `move_speed`: Скорость перемещения танка (целое число).
        *   `shot_timer`: Таймер для определения задержки между выстрелами (целое число).
        *   `shot_delay`: Задержка между выстрелами (целое число).
        *   `bullet_speed`: Скорость снаряда (целое число).
        *   `bullet_damage`: Урон от снаряда (целое число).
        *   `hp`: Количество жизней танка (целое число).
        *   `rank`: Ранг танка, определяющий его характеристики (целое число).
         *   `image`: Текущее изображение танка (pygame.Surface).
        *   `is_move`: Флаг для определения, движется ли танк (bool).
    *   **Методы:**
        *   `__init__(self, color, px, py, direct, keys_list)`: Конструктор класса, инициализирует танк.
        *   `update()`: Обновляет состояние танка (движение, стрельба, столкновения).
        *   `draw()`: Отрисовывает танк на экране.
        *   `damage(value)`: Наносит урон танку.

*   **4.3. Класс `Bullet`**
    *   **Описание:** Представляет выпущенный снаряд, управляет его движением, столкновениями и нанесением урона.
    *   **Атрибуты:**
        *   `parent`: Объект, который выпустил снаряд (Tank).
        *   `px`, `py`: Текущие координаты снаряда (целые числа).
        *   `dx`, `dy`: Скорость снаряда по осям X и Y (целые числа).
        *   `damage`: Урон, который наносит снаряд (целое число).
    *   **Методы:**
        *   `__init__(self, parent, px, py, dx, dy, damage)`: Конструктор класса, инициализирует снаряд.
        *   `update()`: Обновляет положение снаряда и проверяет столкновения.
        *   `draw()`: Отрисовывает снаряд на экране.

*   **4.4. Класс `Block`**
    *   **Описание:** Представляет блок-препятствие на арене.
    *   **Атрибуты:**
        *   `rect`: Прямоугольник для определения позиции и столкновений (pygame.Rect).
        *   `hp`: Количество жизней блока (целое число).
    *   **Методы:**
        *   `__init__(self, px, py, size)`: Конструктор класса, инициализирует блок.
        *   `update()`: Обновляет состояние блока.
        *   `draw()`: Отрисовывает блок на экране.
        *   `damage(value)`: Наносит урон блоку.

*   **4.5. Класс `Bang`**
    *   **Описание:** Представляет анимацию взрыва.
    *   **Атрибуты:**
        *   `px`, `py`: Координаты взрыва (целые числа).
        *   `frame`: Номер текущего кадра анимации (float).
    *   **Методы:**
        *   `__init__(self, px, py)`: Конструктор класса, инициализирует взрыв.
        *   `update()`: Обновляет состояние анимации.
        *   `draw()`: Отрисовывает текущий кадр анимации на экране.

*   **4.6. Класс `Bonus`**
    *   **Описание:** Представляет бонус на карте (звезда или танк), который может улучшить танк игрока.
    *   **Атрибуты:**
        *   `px`, `py`: Координаты бонуса (целые числа).
        *   `bonus_num`: Тип бонуса (целое число: 0 - звезда, 1 - танк).
        *   `timer`: Время существования бонуса (целое число).
        *   `image`: Изображение бонуса (pygame.Surface).
    *   **Методы:**
        *   `__init__(self, px, py, bonus_num)`: Конструктор класса, инициализирует бонус.
        *   `update()`: Обновляет состояние бонуса и проверяет столкновения с танками.
        *   `draw()`: Отрисовывает бонус на экране.
* **4.7. Класс `Button`**
    *   **Описание:** Представляет кнопку пользовательского интерфейса.
    *   **Атрибуты:**
         *   `rect`: Прямоугольник для определения позиции и размера кнопки (pygame.Rect).
         *   `text`: Текст на кнопке (строка).
         *   `color`: Цвет кнопки (строка).
         *   `hover_color`: Цвет кнопки при наведении мыши (строка).
         *   `action`: Функция, выполняемая при нажатии на кнопку (функция).
    *   **Методы:**
         *   `__init__(self, x, y, w, h, text, color, hover_color, action)`: Конструктор класса, инициализирует кнопку.
         *   `draw(surface)`: Отрисовывает кнопку на поверхности.
         *   `check_click()`: Проверяет нажатие кнопки мышью и выполняет соответствующее действие.
* **4.8. Класс `Menu`**
    *   **Описание:** Представляет меню игры, объединяет кнопки и управляет их отображением.
    *   **Атрибуты:**
         *   `buttons`: Список кнопок меню (list).
         *    `title`: Название меню (строка).
    *   **Методы:**
        *   `__init__(self, buttons, title='Меню')`: Конструктор класса, инициализирует меню.
        *    `run()`: Запускает цикл отображения меню и обработки событий.

**5. Дизайн данных**

*   **Структуры данных:**
    *   `objects`: Список, содержащий все игровые объекты (`Tank`, `Bullet`, `Block`, `Bang`, `Bonus`).
    *   `bullets`: Список активных снарядов (`Bullet`).
*   **Формат данных:**
    *   Настройки громкости сохраняются в JSON-файл (`settings.json`) в формате `{"volume": <значение громкости>}`.
    *    Позиции объектов хранятся в виде координат (x, y), представленных целыми числами.
   *   Спрайты и звуки загружаются непосредственно из файлов при старте игры.

**6. Интерфейсы системы**

*   **Внутренние интерфейсы:**
    *   Класс `Game` взаимодействует со всеми игровыми классами для управления их состоянием и отрисовкой.
    *   Класс `Tank` создает объекты `Bullet` при выстреле.
    *   Классы `Tank`, `Bullet`, `Block`, `Bonus` имеют метод `damage()`.
    *   Классы `Tank`, `Bullet`, `Block`, `Bonus`, `Bang` имеют методы `update()` и `draw()`.

*   **Внешние интерфейсы:**
    *   Игроки взаимодействуют с игрой через клавиатуру (стрелки, WASD, пробел, Enter) и мышь (клики для выбора в меню).
    *   Настройки громкости сохраняются и загружаются из файла JSON.

**7. Пользовательский интерфейс**

*   **Описание интерфейса:** Игра имеет главное меню, игровой экран, экран настроек, экран инструкций и экран "Game Over". Основные элементы интерфейса:
    *   Главное меню: Содержит кнопки "Начать игру", "Настройки", "Инструкции", "Выход".
    *   Игровой экран: Отображает танки, блоки, бонусы, снаряды, взрывы, а также иконки танков, их ранги и жизни в верхнем левом углу.
    *    Экран настроек: Позволяет регулировать громкость звука.
    *    Экран инструкций: Выводит прокручиваемый текст с правилами и управлением.
    *   Экран "Game Over": Содержит кнопки "Попробовать снова", "В главное меню", "Выход".

*   **Макеты экранов:** (описательно)
    *   Главное меню: Кнопки выровнены по центру экрана, заголовок вверху.
    *   Игровой экран: Игровое поле, танки, блоки, бонусы и пули. В левом верхнем углу отображаются иконки танков, их ранг и здоровье.
    *    Экран настроек: Заголовок, отображение текущей громкости, кнопка "В главное меню".
    *    Экран инструкций: Прокручиваемый текст с правилами и управлением.
    *   Экран "Game Over": Заголовок "Игра окончена", победивший танк, кнопки "Попробовать снова", "В главное меню", "Выход".

**8. Требования к производительности**

*   **Производительность системы:** Игра должна обеспечивать стабильную частоту кадров не менее 60 FPS.
*   **Ограничения ресурсов:** Игра должна потреблять не более 200 МБ оперативной памяти и минимальное количество процессорного времени.

**9. Безопасность**

*   **Обработка ошибок:**
    *   Для обработки исключений используются блоки `try-except`.
    *   Проверка наличия и корректности файлов ресурсов.
*   **Валидация данных:**
    *   Проверка диапазона значений для параметров игровых объектов.
   *    Проверка правильности сохранения и загрузки настроек громкости.

**10. Обеспечение качества**

*   **Стратегия тестирования:**
    *   Юнит-тестирование отдельных классов (`Tank`, `Bullet`, `Block`, `Bonus`).
    *   Интеграционное тестирование для проверки взаимодействия между классами.
    *   Игровое тестирование для выявления проблем с игровым процессом и UI.
*   **Критерии приемки:**
    *   Игра должна работать без критических ошибок.
    *   Все функции должны соответствовать требованиям, описанным в SRS.
    *   Игра должна обеспечивать плавную анимацию и отзывчивое управление.

**11. Требования к среде разработки**

*   **Инструменты разработки:**
    *   Язык программирования: Python 3.8.
    *   Библиотека: Pygame 2.0.
    *   Редактор кода: Visual Studio Code.

*   **Ограничения среды:**
    *   Игра должна быть совместима с Python 3.8 и Pygame 2.0.
    *   Для запуска игры требуется наличие установленной библиотеки Pygame.

**12. Приложения**

*   **Диаграммы UML:** (Приведены выше в разделе "Диаграмма архитектуры").
*  **Дополнительные материалы**:
    *   Схема игрового цикла: Обработка событий -> Обновление состояния -> Отрисовка.
